<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ğŸ“– Ø§Ø®ØªØ¨Ø§Ø± Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… â€“ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ (Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„)</title>
<style>
  :root{
    --bg:#eaf4ec;            /* Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ Ø¨Ù„ÙˆÙ† Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ */
    --fg:#1f2937;
    --green:#197a3a;         /* Ø£Ø®Ø¶Ø± Ø¯Ø§ÙƒÙ† Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ù…Ø¤Ù‚Øª */
    --green-soft:#2aa15a;
    --card:#ffffff;
    --muted:#6b7280;
    --shadow:0 10px 24px rgba(0,0,0,.08);
    --ok:#16a34a; --bad:#ef4444; --accent:#e3b04b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--fg);font-family:"Amiri","Noto Naskh Arabic",system-ui,-apple-system,"Segoe UI",sans-serif}
  header{padding:22px 16px;text-align:center}
  h1{margin:0 0 6px;font-size:26px;color:var(--green)}
  .sub{color:var(--muted)}
  .wrap{max-width:960px;margin:0 auto;padding:0 16px 28px}
  .card{background:var(--card);border-radius:16px;box-shadow:var(--shadow);padding:20px;margin:14px auto}
  .center{text-align:center}
  .btn{border:none;border-radius:12px;padding:12px 18px;font-size:16px;cursor:pointer}
  .btn-green{background:var(--green);color:#fff}
  .btn-green-soft{background:var(--green-soft);color:#fff}
  .btn-ghost{background:#fff;border:1px solid #e5e7eb;color:var(--fg)}
  .btn-accent{background:var(--accent)}
  .btn-ok{background:var(--ok);color:#fff}
  .btn-bad{background:var(--bad);color:#fff}
  .grid{display:grid;gap:12px}
  .grid-2{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
  .note{color:var(--muted);font-size:14px}
  .timer{font-weight:700;color:var(--green);font-size:18px;margin-bottom:10px}
  .big{font-size:20px;line-height:2}
  .hidden-ellipses{color:#94a3b8}
  .pill{display:inline-block;background:#fff;border:1px solid #d1d5db;color:var(--green);border-radius:999px;padding:6px 10px;font-size:13px}
  #introView, #selectView, #quizView, #resultView{display:none}
  .ck{display:flex;align-items:center;gap:10px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px}
  .ck input{width:20px;height:20px}
  .list{list-style:none;padding:0;margin:0}
  .list li{margin:6px 0}
</style>
</head>
<body>

<header>
  <h1>ğŸ“– Ø§Ø®ØªØ¨Ø§Ø± Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… â€“ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ (Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„)</h1>
  <div class="sub">Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù… <b>Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø­Ø³ÙŠÙ† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ</b> â€“ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù…Ø¬ÙŠØ¯ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø¨Ø§Ù„Ù‚Ø·ÙŠÙ</div>
</header>

<div class="wrap">

  <!-- ØµÙØ­Ø© Ø§Ù„Ø´Ø±Ø­ -->
  <section id="introView" class="card">
    <div class="center" style="font-size:42px;line-height:1;margin-bottom:10px;">ğŸ“—</div>
    <h2 class="center" style="margin-top:0;color:var(--green)">Ø·Ø±ÙŠÙ‚Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
    <div class="grid">
      <p>Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø­ÙØ¸Ùƒ Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ù…Ù‚Ø±Ø±. Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø³ØªØ¸Ù‡Ø± Ù„Ùƒ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø®ØªØ§Ø±ØŒ ÙˆØ§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø£Ù† <b>ØªÙÙƒÙ…Ù„ Ø«Ù„Ø§Ø« ÙƒÙ„Ù…Ø§Øª</b> Ù…Ù† Ø­ÙØ¸Ùƒ Ø®Ù„Ø§Ù„ <b>20 Ø«Ø§Ù†ÙŠØ©</b>.</p>
      <ul>
        <li>Ø¨Ø¹Ø¯ Ø£Ù† ØªÙ‚ÙˆÙ„ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø´ÙÙ‡ÙŠÙ‹Ø§ØŒ Ø§Ø¶ØºØ· <b>Â«Ø£Ø¸Ù‡Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©Â»</b> Ù„ØªØ±Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„ØµØ­ÙŠØ­.</li>
        <li>Ù‚Ø§Ø±Ù† Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø«Ù… Ø§Ø®ØªØ±: <b>âœ… ØµÙˆØ§Ø¨</b> Ø£Ùˆ <b>âŒ Ø®Ø·Ø£</b>.</li>
        <li>Ø¨Ø¹Ø¯ Ø¢Ø®Ø± Ø³Ø¤Ø§Ù„ Ø³ØªØ¸Ù‡Ø± Ù„Ùƒ <b>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</b>ØŒ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.</li>
      </ul>
      <div class="note">ØªØ°ÙƒÙŠØ±: Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¯Ø§Ø¦Ù…Ù‹Ø§ <b>Ø¥ÙƒÙ…Ø§Ù„ Ø«Ù„Ø§Ø« ÙƒÙ„Ù…Ø§Øª</b> ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø§Ù„Ø¸Ø§Ù‡Ø±.</div>
    </div>
    <div class="center" style="margin-top:14px;">
      <button class="btn btn-green" id="goSelect">Ø§Ø¨Ø¯Ø£ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø·Ø¹</button>
    </div>
  </section>

  <!-- Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø© Ù…Ù‚Ø§Ø·Ø¹ -->
  <section id="selectView" class="card">
    <h2 class="center" style="margin-top:0;color:var(--green)">Ø§Ø®ØªØ± Ù…Ù‚Ø·Ø¹Ù‹Ø§ Ø£Ùˆ Ø£ÙƒØ«Ø± (Ù¥ Ø£Ø³Ø¦Ù„Ø© Ù„ÙƒÙ„ Ù…Ù‚Ø·Ø¹)</h2>

    <div class="grid grid-2" id="checks">
      <label class="ck"><input type="checkbox" value="hud"/><span>Ø³ÙˆØ±Ø© Ù‡ÙˆØ¯ (102â€“108)</span></label>
      <label class="ck"><input type="checkbox" value="raad"/><span>Ø³ÙˆØ±Ø© Ø§Ù„Ø±Ø¹Ø¯ (8â€“13)</span></label>
      <label class="ck"><input type="checkbox" value="ibrahim"/><span>Ø³ÙˆØ±Ø© Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… (42â€“52)</span></label>
      <label class="ck"><input type="checkbox" value="nahl"/><span>Ø³ÙˆØ±Ø© Ø§Ù„Ù†Ø­Ù„ (125â€“128)</span></label>
      <label class="ck"><input type="checkbox" value="isra"/><span>Ø³ÙˆØ±Ø© Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡ (23â€“27)</span></label>
    </div>

    <div class="center" style="margin:10px 0;">
      <span class="pill">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø«Ø§Ø¨ØªØ©: 12 ÙƒÙ„Ù…Ø© Ø³Ø¤Ø§Ù„ â€¢ 3 ÙƒÙ„Ù…Ø§Øª Ø¥Ø¬Ø§Ø¨Ø© â€¢ 20 Ø«Ø§Ù†ÙŠØ©</span>
    </div>

    <div class="center" style="margin-top:10px;">
      <button class="btn btn-green" id="startMulti">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
    </div>
  </section>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
  <section id="quizView" class="card center">
    <div class="timer">â³ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="remaining">--</span> Ø«Ø§Ù†ÙŠØ©</div>
    <div id="passageTitle" class="note" style="margin-bottom:8px;"></div>
    <div id="questionText" class="big"></div>
    <div class="note" id="progressText" style="margin-top:6px;"></div>
    <div style="margin-top:14px;">
      <button id="flipBtn" class="btn btn-accent">Ø£Ø¸Ù‡Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
    </div>
    <div id="answerArea" style="display:none;margin-top:12px;">
      <div id="answerText" class="big"></div>
      <div style="margin-top:10px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
        <button id="correctBtn" class="btn btn-ok">âœ… ØµÙˆØ§Ø¨</button>
        <button id="wrongBtn" class="btn btn-bad">âŒ Ø®Ø·Ø£</button>
      </div>
    </div>
  </section>

  <!-- ØµÙØ­Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
  <section id="resultView" class="card center">
    <h2 style="margin-top:0;color:var(--green)">Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h2>
    <ul id="breakdown" class="list"></ul>
    <h3 id="finalScore" style="color:var(--green)"></h3>
    <div style="color:var(--green);margin:6px 0;">ğŸŒ¿ <em>Ø£Ø­Ø³Ù†Øª! ÙˆØ§ØµÙ„ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù„ØªØªÙ‚Ù† Ø§Ù„Ø­ÙØ¸ Ø£ÙƒØ«Ø±.</em></div>
    <div class="note">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„ØªÙ‚ÙˆÙŠÙ… Ø­ÙØ¸Ùƒ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</div>
    <div style="margin-top:14px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
      <button id="backToSelect" class="btn btn-ghost">ğŸ” Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹</button>
      <button id="repeatAll" class="btn btn-green">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù†ÙØ³Ù‡</button>
    </div>
  </section>

</div>

<!-- ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª -->
<audio id="beep">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

<script>
/* ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹ (Ø¨Ø¯ÙˆÙ† Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¢ÙŠØ§Øª) ===== */
const PASSAGES = {
  hud: {
    title: "Ø³ÙˆØ±Ø© Ù‡ÙˆØ¯ (102â€“108)",
    text: `ÙˆÙÙƒÙØ°ÙÙ°Ù„ÙÙƒÙ Ø£ÙØ®Ù’Ø°Ù Ø±ÙØ¨ÙÙ‘ÙƒÙ Ø¥ÙØ°ÙØ§ Ø£ÙØ®ÙØ°Ù Ø§Ù„Ù’Ù‚ÙØ±ÙÙ‰Ù° ÙˆÙÙ‡ÙÙŠÙ Ø¸ÙØ§Ù„ÙÙ…ÙØ©ÙŒ Ø¥ÙÙ†Ù‘Ù Ø£ÙØ®Ù’Ø°ÙÙ‡Ù Ø£ÙÙ„ÙÙŠÙ…ÙŒ Ø´ÙØ¯ÙÙŠØ¯ÙŒ
Ø¥ÙÙ†Ù‘Ù ÙÙÙŠ Ø°ÙÙ°Ù„ÙÙƒÙ Ù„ÙØ¢ÙŠÙØ©Ù‹ Ù„ÙÙ…ÙÙ†Ù’ Ø®ÙØ§ÙÙ Ø¹ÙØ°ÙØ§Ø¨Ù Ø§Ù„Ù’Ø¢Ø®ÙØ±ÙØ©Ù Ø°ÙÙ°Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…ÙŒ Ù…ÙØ¬Ù’Ù…ÙÙˆØ¹ÙŒ Ù„Ù‘ÙÙ‡Ù Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù ÙˆÙØ°ÙÙ°Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…ÙŒ Ù…Ù‘ÙØ´Ù’Ù‡ÙÙˆØ¯ÙŒ
ÙˆÙÙ…ÙØ§ Ù†ÙØ¤ÙØ®Ù‘ÙØ±ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù„ÙØ£ÙØ¬ÙÙ„Ù Ù…Ù‘ÙØ¹Ù’Ø¯ÙÙˆØ¯Ù
ÙŠÙÙˆÙ’Ù…Ù ÙŠÙØ£Ù’ØªÙ Ù„ÙØ§ ØªÙÙƒÙÙ„Ù‘ÙÙ…Ù Ù†ÙÙÙ’Ø³ÙŒ Ø¥ÙÙ„Ù‘ÙØ§ Ø¨ÙØ¥ÙØ°Ù’Ù†ÙÙ‡Ù ÙÙÙ…ÙÙ†Ù’Ù‡ÙÙ…Ù’ Ø´ÙÙ‚ÙÙŠÙ‘ÙŒ ÙˆÙØ³ÙØ¹ÙÙŠØ¯ÙŒ
ÙÙØ£ÙÙ…Ù‘ÙØ§ Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø´ÙÙ‚ÙÙˆØ§ ÙÙÙÙÙŠ Ø§Ù„Ù†Ù‘ÙØ§Ø±Ù Ù„ÙÙ‡ÙÙ…Ù’ ÙÙÙŠÙ‡ÙØ§ Ø²ÙÙÙÙŠØ±ÙŒ ÙˆÙØ´ÙÙ‡ÙÙŠÙ‚ÙŒ
Ø®ÙØ§Ù„ÙØ¯ÙÙŠÙ†Ù ÙÙÙŠÙ‡ÙØ§ Ù…ÙØ§ Ø¯ÙØ§Ù…ÙØªÙ Ø§Ù„Ø³Ù‘ÙÙ…ÙØ§ÙˆÙØ§ØªÙ ÙˆÙØ§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù…ÙØ§ Ø´ÙØ§Ø¡Ù Ø±ÙØ¨Ù‘ÙÙƒÙ Ø¥ÙÙ†Ù‘Ù Ø±ÙØ¨Ù‘ÙÙƒÙ ÙÙØ¹Ù‘ÙØ§Ù„ÙŒ Ù„ÙÙ…ÙØ§ ÙŠÙØ±ÙÙŠØ¯Ù
ÙˆÙØ£ÙÙ…Ù‘ÙØ§ Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø³ÙØ¹ÙØ¯ÙÙˆØ§ ÙÙÙÙÙŠ Ø§Ù„Ù’Ø¬ÙÙ†Ù‘ÙØ©Ù Ø®ÙØ§Ù„ÙØ¯ÙÙŠÙ†Ù ÙÙÙŠÙ‡ÙØ§ Ù…ÙØ§ Ø¯ÙØ§Ù…ÙØªÙ Ø§Ù„Ø³Ù‘ÙÙ…ÙØ§ÙˆÙØ§ØªÙ ÙˆÙØ§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù…ÙØ§ Ø´ÙØ§Ø¡Ù Ø±ÙØ¨Ù‘ÙÙƒÙ Ø¹ÙØ·ÙØ§Ø¡Ù‹ ØºÙÙŠÙ’Ø±Ù Ù…ÙØ¬Ù’Ø°ÙÙˆØ°Ù`
  },
  raad: {
    title: "Ø³ÙˆØ±Ø© Ø§Ù„Ø±Ø¹Ø¯ (8â€“13)",
    text: `Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙŠÙØ¹Ù’Ù„ÙÙ…Ù Ù…ÙØ§ ØªÙØ­Ù’Ù…ÙÙ„Ù ÙƒÙÙ„Ù‘Ù Ø£ÙÙ†Ø«ÙÙ‰Ù° ÙˆÙÙ…ÙØ§ ØªÙØºÙÙŠØ¶Ù Ø§Ù„Ù’Ø£ÙØ±Ù’Ø­ÙØ§Ù…Ù ÙˆÙÙ…ÙØ§ ØªÙØ²Ù’Ø¯ÙØ§Ø¯Ù ÙˆÙÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù Ø¹ÙÙ†Ù’Ø¯ÙÙ‡Ù Ø¨ÙÙ…ÙÙ‚Ù’Ø¯ÙØ§Ø±Ù
Ø¹ÙØ§Ù„ÙÙ…Ù Ø§Ù„Ù’ØºÙÙŠÙ’Ø¨Ù ÙˆÙØ§Ù„Ø´Ù‘ÙÙ‡ÙØ§Ø¯ÙØ©Ù Ø§Ù„Ù’ÙƒÙØ¨ÙÙŠØ±Ù Ø§Ù„Ù’Ù…ÙØªÙØ¹ÙØ§Ù„Ù
Ø³ÙÙˆÙØ§Ø¡ÙŒ Ù…ÙÙ†Ù’ÙƒÙÙ…Ù’ Ù…ÙÙ†Ù’ Ø£ÙØ³ÙØ±Ù‘Ù Ø§Ù„Ù’Ù‚ÙÙˆÙ’Ù„Ù ÙˆÙÙ…ÙÙ†Ù’ Ø¬ÙÙ‡ÙØ±Ù Ø¨ÙÙ‡Ù ÙˆÙÙ…ÙÙ†Ù’ Ù‡ÙÙˆÙ Ù…ÙØ³Ù’ØªÙØ®Ù’ÙÙ Ø¨ÙØ§Ù„Ù„Ù‘ÙÙŠÙ’Ù„Ù ÙˆÙØ³ÙØ§Ø±ÙØ¨ÙŒ Ø¨ÙØ§Ù„Ù†Ù‘ÙÙ‡ÙØ§Ø±Ù
Ù„ÙÙ‡Ù Ù…ÙØ¹ÙÙ‚Ù‘ÙØ¨ÙØ§ØªÙŒ Ù…ÙÙ†Ù’ Ø¨ÙÙŠÙ’Ù†Ù ÙŠÙØ¯ÙÙŠÙ’Ù‡Ù ÙˆÙÙ…ÙÙ†Ù’ Ø®ÙÙ„Ù’ÙÙÙ‡Ù ÙŠÙØ­Ù’ÙÙØ¸ÙÙˆÙ†ÙÙ‡Ù Ù…ÙÙ†Ù’ Ø£ÙÙ…Ù’Ø±Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø¥ÙÙ†Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù„ÙØ§ ÙŠÙØºÙÙŠÙ‘ÙØ±Ù Ù…ÙØ§ Ø¨ÙÙ‚ÙÙˆÙ’Ù…Ù Ø­ÙØªÙ‘ÙÙ‰Ù° ÙŠÙØºÙÙŠÙ‘ÙØ±ÙÙˆØ§ Ù…ÙØ§ Ø¨ÙØ£ÙÙ†Ù’ÙÙØ³ÙÙ‡ÙÙ…Ù’ ÙˆÙØ¥ÙØ°ÙØ§ Ø£ÙØ±ÙØ§Ø¯Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø¨ÙÙ‚ÙÙˆÙ’Ù…Ù Ø³ÙÙˆØ¡Ù‹Ø§ ÙÙÙ„ÙØ§ Ù…ÙØ±ÙØ¯Ù‘Ù Ù„ÙÙ‡Ù ÙˆÙÙ…ÙØ§ Ù„ÙÙ‡ÙÙ…Ù’ Ù…ÙÙ†Ù’ Ø¯ÙÙˆÙ†ÙÙ‡Ù Ù…ÙÙ†Ù’ ÙˆÙØ§Ù„Ù
Ù‡ÙÙˆÙ Ø§Ù„Ù‘ÙØ°ÙÙŠ ÙŠÙØ±ÙÙŠÙƒÙÙ…Ù Ø§Ù„Ù’Ø¨ÙØ±Ù’Ù‚Ù Ø®ÙÙˆÙ’ÙÙ‹Ø§ ÙˆÙØ·ÙÙ…ÙØ¹Ù‹Ø§ ÙˆÙÙŠÙÙ†Ù’Ø´ÙØ¦Ù Ø§Ù„Ø³Ù‘ÙØ­ÙØ§Ø¨Ù Ø§Ù„Ø«Ù‘ÙÙ‚ÙØ§Ù„Ù
ÙˆÙÙŠÙØ³ÙØ¨Ù‘ÙØ­Ù Ø§Ù„Ø±Ù‘ÙØ¹Ù’Ø¯Ù Ø¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡Ù ÙˆÙØ§Ù„Ù’Ù…ÙÙ„ÙØ§Ø¦ÙÙƒÙØ©Ù Ù…ÙÙ†Ù’ Ø®ÙÙŠÙÙØªÙÙ‡Ù ÙˆÙÙŠÙØ±Ù’Ø³ÙÙ„Ù Ø§Ù„ØµÙ‘ÙÙˆÙØ§Ø¹ÙÙ‚Ù ÙÙÙŠÙØµÙÙŠØ¨Ù Ø¨ÙÙ‡ÙØ§ Ù…ÙÙ†Ù’ ÙŠÙØ´ÙØ§Ø¡Ù ÙˆÙÙ‡ÙÙ…Ù’ ÙŠÙØ¬ÙØ§Ø¯ÙÙ„ÙÙˆÙ†Ù ÙÙÙŠ Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙÙ‡ÙÙˆÙ Ø´ÙØ¯ÙÙŠØ¯Ù Ø§Ù„Ù’Ù…ÙØ­ÙØ§Ù„Ù`
  },
  ibrahim: {
    title: "Ø³ÙˆØ±Ø© Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… (42â€“52)",
    text: `ÙˆÙÙ„ÙØ§ ØªÙØ­Ù’Ø³ÙØ¨ÙÙ†Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù ØºÙØ§ÙÙÙ„Ù‹Ø§ Ø¹ÙÙ…Ù‘ÙØ§ ÙŠÙØ¹Ù’Ù…ÙÙ„Ù Ø§Ù„Ø¸Ù‘ÙØ§Ù„ÙÙ…ÙÙˆÙ†Ù Ø¥ÙÙ†Ù‘ÙÙ…ÙØ§ ÙŠÙØ¤ÙØ®Ù‘ÙØ±ÙÙ‡ÙÙ…Ù’ Ù„ÙÙŠÙÙˆÙ’Ù…Ù ØªÙØ´Ù’Ø®ÙØµÙ ÙÙÙŠÙ‡Ù Ø§Ù„Ù’Ø£ÙØ¨Ù’ØµÙØ§Ø±Ù
Ù…ÙÙ‡Ù’Ø·ÙØ¹ÙÙŠÙ†Ù Ù…ÙÙ‚Ù’Ù†ÙØ¹ÙÙŠ Ø±ÙØ¡ÙÙˆØ³ÙÙ‡ÙÙ…Ù’ Ù„ÙØ§ ÙŠÙØ±Ù’ØªÙØ¯Ù‘Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ Ø·ÙØ±Ù’ÙÙÙ‡ÙÙ…Ù’ ÙˆÙØ£ÙÙÙ’Ø¦ÙØ¯ÙØªÙÙ‡ÙÙ…Ù’ Ù‡ÙÙˆÙØ§Ø¡ÙŒ
ÙˆÙØ£ÙÙ†Ù’Ø°ÙØ±Ù Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù ÙŠÙÙˆÙ’Ù…Ù ÙŠÙØ£Ù’ØªÙÙŠÙ‡ÙÙ…Ù Ø§Ù„Ù’Ø¹ÙØ°ÙØ§Ø¨Ù ÙÙÙŠÙÙ‚ÙÙˆÙ„Ù Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¸ÙÙ„ÙÙ…ÙÙˆØ§ Ø±ÙØ¨Ù‘ÙÙ†ÙØ§ Ø£ÙØ®Ù‘ÙØ±Ù’Ù†ÙØ§ Ø¥ÙÙ„ÙÙ‰Ù° Ø£ÙØ¬ÙÙ„Ù Ù‚ÙØ±ÙÙŠØ¨Ù Ù†ÙØ¬ÙØ¨Ù’ Ø¯ÙØ¹Ù’ÙˆÙØªÙÙƒÙ ÙˆÙÙ†ÙØªÙ‘ÙØ¨ÙØ¹Ù Ø§Ù„Ø±Ù‘ÙØ³ÙÙ„Ù Ø£ÙÙˆÙÙ„ÙÙ…Ù’ ØªÙÙƒÙÙˆÙ†ÙÙˆØ§ Ø£ÙÙ‚Ù’Ø³ÙÙ…Ù’ØªÙÙ…Ù’ Ù…ÙÙ†Ù’ Ù‚ÙØ¨Ù’Ù„Ù Ù…ÙØ§ Ù„ÙÙƒÙÙ…Ù’ Ù…ÙÙ†Ù’ Ø²ÙÙˆÙØ§Ù„Ù
ÙˆÙØ³ÙÙƒÙÙ†Ù’ØªÙÙ…Ù’ ÙÙÙŠ Ù…ÙØ³ÙØ§ÙƒÙÙ†Ù Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¸ÙÙ„ÙÙ…ÙÙˆØ§ Ø£ÙÙ†Ù’ÙÙØ³ÙÙ‡ÙÙ…Ù’ ÙˆÙØªÙØ¨ÙÙŠÙ‘ÙÙ†Ù Ù„ÙÙƒÙÙ…Ù’ ÙƒÙÙŠÙ’ÙÙ ÙÙØ¹ÙÙ„Ù’Ù†ÙØ§ Ø¨ÙÙ‡ÙÙ…Ù’ ÙˆÙØ¶ÙØ±ÙØ¨Ù’Ù†ÙØ§ Ù„ÙÙƒÙÙ…Ù Ø§Ù„Ù’Ø£ÙÙ…Ù’Ø«ÙØ§Ù„Ù
ÙˆÙÙ‚ÙØ¯Ù’ Ù…ÙÙƒÙØ±ÙÙˆØ§ Ù…ÙÙƒÙ’Ø±ÙÙ‡ÙÙ…Ù’ ÙˆÙØ¹ÙÙ†Ù’Ø¯Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù…ÙÙƒÙ’Ø±ÙÙ‡ÙÙ…Ù’ ÙˆÙØ¥ÙÙ†Ù’ ÙƒÙØ§Ù†Ù Ù…ÙÙƒÙ’Ø±ÙÙ‡ÙÙ…Ù’ Ù„ÙØªÙØ²ÙÙˆÙ„Ù Ù…ÙÙ†Ù’Ù‡Ù Ø§Ù„Ù’Ø¬ÙØ¨ÙØ§Ù„Ù
ÙÙÙ„ÙØ§ ØªÙØ­Ù’Ø³ÙØ¨ÙÙ†Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù…ÙØ®Ù’Ù„ÙÙÙ ÙˆÙØ¹Ù’Ø¯ÙÙ‡Ù Ø±ÙØ³ÙÙ„ÙÙ‡Ù Ø¥ÙÙ†Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø¹ÙØ²ÙÙŠØ²ÙŒ Ø°ÙÙˆ Ø§Ù†Ù’ØªÙÙ‚ÙØ§Ù…Ù
ÙŠÙÙˆÙ’Ù…Ù ØªÙØ¨ÙØ¯Ù‘ÙÙ„Ù Ø§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù ØºÙÙŠÙ’Ø±Ù Ø§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù ÙˆÙØ§Ù„Ø³Ù‘ÙÙ…ÙØ§ÙˆÙØ§ØªÙ ÙˆÙØ¨ÙØ±ÙØ²ÙÙˆØ§ Ù„ÙÙ„Ù‘ÙÙ‡Ù Ø§Ù„Ù’ÙˆÙØ§Ø­ÙØ¯Ù Ø§Ù„Ù’Ù‚ÙÙ‡Ù‘ÙØ§Ø±Ù
ÙˆÙØªÙØ±ÙÙ‰ Ø§Ù„Ù’Ù…ÙØ¬Ù’Ø±ÙÙ…ÙÙŠÙ†Ù ÙŠÙÙˆÙ’Ù…ÙØ¦ÙØ°Ù Ù…ÙÙ‚ÙØ±Ù‘ÙÙ†ÙÙŠÙ†Ù ÙÙÙŠ Ø§Ù„Ù’Ø£ÙØµÙ’ÙÙØ§Ø¯Ù
Ø³ÙØ±ÙØ§Ø¨ÙÙŠÙ„ÙÙ‡ÙÙ…Ù’ Ù…ÙÙ†Ù’ Ù‚ÙØ·ÙØ±ÙØ§Ù†Ù ÙˆÙØªÙØºÙ’Ø´ÙÙ‰Ù° ÙˆÙØ¬ÙÙˆÙ‡ÙÙ‡ÙÙ…Ù Ø§Ù„Ù†Ù‘ÙØ§Ø±Ù
Ù„ÙÙŠÙØ¬Ù’Ø²ÙÙŠÙ Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙƒÙÙ„Ù‘Ù Ù†ÙÙÙ’Ø³Ù Ù…ÙØ§ ÙƒÙØ³ÙØ¨ÙØªÙ’ Ø¥ÙÙ†Ù‘Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø³ÙØ±ÙÙŠØ¹Ù Ø§Ù„Ù’Ø­ÙØ³ÙØ§Ø¨Ù
Ù‡ÙÙ°Ø°ÙØ§ Ø¨ÙÙ„ÙØ§ØºÙŒ Ù„ÙÙ„Ù†Ù‘ÙØ§Ø³Ù ÙˆÙÙ„ÙÙŠÙÙ†Ù’Ø°ÙØ±ÙÙˆØ§ Ø¨ÙÙ‡Ù ÙˆÙÙ„ÙÙŠÙØ¹Ù’Ù„ÙÙ…ÙÙˆØ§ Ø£ÙÙ†Ù‘ÙÙ…ÙØ§ Ù‡ÙÙˆÙ Ø¥ÙÙ„ÙÙ°Ù‡ÙŒ ÙˆÙØ§Ø­ÙØ¯ÙŒ ÙˆÙÙ„ÙÙŠÙØ°Ù‘ÙÙƒÙ‘ÙØ±Ù Ø£ÙÙˆÙ„ÙÙˆ Ø§Ù„Ù’Ø£ÙÙ„Ù’Ø¨ÙØ§Ø¨Ù`
  },
  nahl: {
    title: "Ø³ÙˆØ±Ø© Ø§Ù„Ù†Ø­Ù„ (125â€“128)",
    text: `Ø§Ø¯Ù’Ø¹Ù Ø¥ÙÙ„ÙÙ‰Ù° Ø³ÙØ¨ÙÙŠÙ„Ù Ø±ÙØ¨ÙÙ‘ÙƒÙ Ø¨ÙØ§Ù„Ù’Ø­ÙÙƒÙ’Ù…ÙØ©Ù ÙˆÙØ§Ù„Ù’Ù…ÙÙˆÙ’Ø¹ÙØ¸ÙØ©Ù Ø§Ù„Ù’Ø­ÙØ³ÙÙ†ÙØ©Ù ÙˆÙØ¬ÙØ§Ø¯ÙÙ„Ù’Ù‡ÙÙ…Ù’ Ø¨ÙØ§Ù„ÙÙ‘ØªÙÙŠ Ù‡ÙÙŠÙ Ø£ÙØ­Ù’Ø³ÙÙ†Ù Ø¥ÙÙ†ÙÙ‘ Ø±ÙØ¨ÙÙ‘ÙƒÙ Ù‡ÙÙˆÙ Ø£ÙØ¹Ù’Ù„ÙÙ…Ù Ø¨ÙÙ…ÙÙ†Ù’ Ø¶ÙÙ„ÙÙ‘ Ø¹ÙÙ†Ù’ Ø³ÙØ¨ÙÙŠÙ„ÙÙ‡Ù ÙˆÙÙ‡ÙÙˆÙ Ø£ÙØ¹Ù’Ù„ÙÙ…Ù Ø¨ÙØ§Ù„Ù’Ù…ÙÙ‡Ù’ØªÙØ¯ÙÙŠÙ†Ù
ÙˆÙØ¥ÙÙ†Ù’ Ø¹ÙØ§Ù‚ÙØ¨Ù’ØªÙÙ…Ù’ ÙÙØ¹ÙØ§Ù‚ÙØ¨ÙÙˆØ§ Ø¨ÙÙ…ÙØ«Ù’Ù„Ù Ù…ÙØ§ Ø¹ÙÙˆÙ‚ÙØ¨Ù’ØªÙÙ…Ù’ Ø¨ÙÙ‡Ù ÙˆÙÙ„ÙØ¦ÙÙ†Ù’ ØµÙØ¨ÙØ±Ù’ØªÙÙ…Ù’ Ù„ÙÙ‡ÙÙˆÙ Ø®ÙÙŠÙ’Ø±ÙŒ Ù„ÙÙ„ØµÙÙ‘Ø§Ø¨ÙØ±ÙÙŠÙ†Ù
ÙˆÙØ§ØµÙ’Ø¨ÙØ±Ù’ ÙˆÙÙ…ÙØ§ ØµÙØ¨Ù’Ø±ÙÙƒÙ Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙÙ„ÙØ§ ØªÙØ­Ù’Ø²ÙÙ†Ù’ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ ØªÙÙƒÙ ÙÙÙŠ Ø¶ÙÙŠÙ’Ù‚Ù Ù…ÙÙ…ÙÙ‘Ø§ ÙŠÙÙ…Ù’ÙƒÙØ±ÙÙˆÙ†Ù
Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù…ÙØ¹Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø§ØªÙÙ‘Ù‚ÙÙˆÙ’Ø§ ÙˆÙØ§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ù‡ÙÙ…Ù’ Ù…ÙØ­Ù’Ø³ÙÙ†ÙÙˆÙ†Ù`
  },
  isra: {
    title: "Ø³ÙˆØ±Ø© Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡ (23â€“27)",
    text: `ÙˆÙÙ‚ÙØ¶ÙÙ‰Ù° Ø±ÙØ¨ÙÙ‘ÙƒÙ Ø£ÙÙ„ÙÙ‘Ø§ ØªÙØ¹Ù’Ø¨ÙØ¯ÙÙˆØ§ Ø¥ÙÙ„ÙÙ‘Ø§ Ø¥ÙÙŠÙÙ‘Ø§Ù‡Ù ÙˆÙØ¨ÙØ§Ù„Ù’ÙˆÙØ§Ù„ÙØ¯ÙÙŠÙ’Ù†Ù Ø¥ÙØ­Ù’Ø³ÙØ§Ù†Ù‹Ø§ Ø¥ÙÙ…ÙÙ‘Ø§ ÙŠÙØ¨Ù’Ù„ÙØºÙÙ†ÙÙ‘ Ø¹ÙÙ†Ù’Ø¯ÙÙƒÙ Ø§Ù„Ù’ÙƒÙØ¨ÙØ±Ù Ø£ÙØ­ÙØ¯ÙÙ‡ÙÙ…ÙØ§ Ø£ÙÙˆÙ’ ÙƒÙÙ„ÙØ§Ù‡ÙÙ…ÙØ§ ÙÙÙ„ÙØ§ ØªÙÙ‚ÙÙ„Ù’ Ù„ÙÙ‡ÙÙ…ÙØ§ Ø£ÙÙÙÙ‘ ÙˆÙÙ„ÙØ§ ØªÙÙ†Ù’Ù‡ÙØ±Ù’Ù‡ÙÙ…ÙØ§ ÙˆÙÙ‚ÙÙ„Ù’ Ù„ÙÙ‡ÙÙ…ÙØ§ Ù‚ÙÙˆÙ’Ù„Ù‹Ø§ ÙƒÙØ±ÙÙŠÙ…Ù‹Ø§
ÙˆÙØ§Ø®Ù’ÙÙØ¶Ù’ Ù„ÙÙ‡ÙÙ…ÙØ§ Ø¬ÙÙ†ÙØ§Ø­Ù Ø§Ù„Ø°ÙÙ‘Ù„ÙÙ‘ Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙØ©Ù ÙˆÙÙ‚ÙÙ„Ù’ Ø±ÙØ¨ÙÙ‘ Ø§Ø±Ù’Ø­ÙÙ…Ù’Ù‡ÙÙ…ÙØ§ ÙƒÙÙ…ÙØ§ Ø±ÙØ¨ÙÙ‘ÙŠÙØ§Ù†ÙÙŠ ØµÙØºÙÙŠØ±Ù‹Ø§
Ø±ÙØ¨ÙÙ‘ÙƒÙÙ…Ù’ Ø£ÙØ¹Ù’Ù„ÙÙ…Ù Ø¨ÙÙ…ÙØ§ ÙÙÙŠ Ù†ÙÙÙÙˆØ³ÙÙƒÙÙ…Ù’ Ø¥ÙÙ†Ù’ ØªÙÙƒÙÙˆÙ†ÙÙˆØ§ ØµÙØ§Ù„ÙØ­ÙÙŠÙ†Ù ÙÙØ¥ÙÙ†ÙÙ‘Ù‡Ù ÙƒÙØ§Ù†Ù Ù„ÙÙ„Ù’Ø£ÙÙˆÙÙ‘Ø§Ø¨ÙÙŠÙ†Ù ØºÙÙÙÙˆØ±Ù‹Ø§
ÙˆÙØ¢ØªÙ Ø°ÙØ§ Ø§Ù„Ù’Ù‚ÙØ±Ù’Ø¨ÙÙ‰Ù° Ø­ÙÙ‚ÙÙ‘Ù‡Ù ÙˆÙØ§Ù„Ù’Ù…ÙØ³Ù’ÙƒÙÙŠÙ†Ù ÙˆÙØ§Ø¨Ù’Ù†Ù Ø§Ù„Ø³ÙÙ‘Ø¨ÙÙŠÙ„Ù ÙˆÙÙ„ÙØ§ ØªÙØ¨ÙØ°ÙÙ‘Ø±Ù’ ØªÙØ¨Ù’Ø°ÙÙŠØ±Ù‹Ø§
Ø¥ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ù…ÙØ¨ÙØ°ÙÙ‘Ø±ÙÙŠÙ†Ù ÙƒÙØ§Ù†ÙÙˆØ§ Ø¥ÙØ®Ù’ÙˆÙØ§Ù†Ù Ø§Ù„Ø´ÙÙ‘ÙŠÙØ§Ø·ÙÙŠÙ†Ù ÙˆÙÙƒÙØ§Ù†Ù Ø§Ù„Ø´ÙÙ‘ÙŠÙ’Ø·ÙØ§Ù†Ù Ù„ÙØ±ÙØ¨ÙÙ‘Ù‡Ù ÙƒÙÙÙÙˆØ±Ù‹Ø§`
  }
};

/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø«Ø§Ø¨ØªØ© */
const prefix = 12, suffix = 3, perPassageQuestions = 5, timerSeconds = 20;

/* Ø¹Ù†Ø§ØµØ± DOM */
const introView  = document.getElementById('introView');
const selectView = document.getElementById('selectView');
const quizView   = document.getElementById('quizView');
const resultView = document.getElementById('resultView');

const goSelectBtn = document.getElementById('goSelect');
const startMulti  = document.getElementById('startMulti');

const questionText = document.getElementById('questionText');
const answerArea   = document.getElementById('answerArea');
const answerText   = document.getElementById('answerText');
const progressText = document.getElementById('progressText');
const remainingEl  = document.getElementById('remaining');
const passageTitle = document.getElementById('passageTitle');

const flipBtn = document.getElementById('flipBtn');
const okBtn   = document.getElementById('correctBtn');
const badBtn  = document.getElementById('wrongBtn');

const breakdown  = document.getElementById('breakdown');
const finalScore = document.getElementById('finalScore');
const backToSelect = document.getElementById('backToSelect');
const repeatAll    = document.getElementById('repeatAll');

const beep = document.getElementById('beep');

/* Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± */
let selectedKeys = [];
let currentPassageIdx = 0;
let currentQIdx = 0;
let indicesMap = {};     // key -> indices array
let wordsMap = {};       // key -> words array
let scores = {};         // key -> {title, correct, total}

/* Ù…Ø¤Ù‚Øª */
let remaining = timerSeconds;
let timerId = null;

/* Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ */
function show(id){
  introView.style.display  = (id==='intro')  ? 'block' : 'none';
  selectView.style.display = (id==='select') ? 'block' : 'none';
  quizView.style.display   = (id==='quiz')   ? 'block' : 'none';
  resultView.style.display = (id==='result') ? 'block' : 'none';
}

/* Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
show('intro');
goSelectBtn.onclick = () => show('select');

/* Ø¨Ø¯Ø¡ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø§Ø·Ø¹ Ù…ØªØ¹Ø¯Ø¯Ø© */
startMulti.onclick = () => {
  const checked = Array.from(document.querySelectorAll('#checks input[type=checkbox]:checked'))
                       .map(el => el.value);
  if (checked.length === 0) {
    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø·Ø¹ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.');
    return;
  }
  startMultiQuiz(checked);
};

function startMultiQuiz(keys){
  selectedKeys = keys;
  indicesMap = {};
  wordsMap = {};
  scores = {};
  currentPassageIdx = 0;
  currentQIdx = 0;

  // ØªØ­Ø¶ÙŠØ± ÙƒÙ„Ù…Ø§Øª ÙƒÙ„ Ù…Ù‚Ø·Ø¹ ÙˆØ§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„ÙƒÙ„ Ù…Ù‚Ø·Ø¹
  for (const k of selectedKeys){
    const w = PASSAGES[k].text.trim().split(/\s+/);
    wordsMap[k] = w;
    const maxStart = Math.max(0, w.length - (prefix + suffix));
    const need = Math.min(perPassageQuestions, maxStart); // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Øµ Ù‚ØµÙŠØ±Ù‹Ø§ Ø¬Ø¯Ù‹Ø§
    const inds = [];
    while (inds.length < need) {
      const r = Math.floor(Math.random() * Math.max(1, maxStart));
      if (!inds.includes(r)) inds.push(r);
      if (maxStart === 0) break; // Ø­Ù…Ø§ÙŠØ© Ù„Ù„Ù†Øµ Ø§Ù„Ù‚ØµÙŠØ± Ø¬Ø¯Ù‹Ø§
    }
    indicesMap[k] = inds;
    scores[k] = {title: PASSAGES[k].title, correct: 0, total: inds.length};
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚: Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ØŸ
  const totalQs = selectedKeys.reduce((s,k)=> s + indicesMap[k].length, 0);
  if (totalQs === 0){
    alert('Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø¤Ø§Ù„/Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø·Ø¹ Ø£Ø·ÙˆÙ„ Ø£Ùˆ ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø¥Ù† ÙƒØ§Ù†Øª Ù‚Ø§Ø¨Ù„Ø©).');
    return;
  }

  show('quiz');
  renderCard();
}

/* Ø¹Ø±Ø¶ Ø³Ø¤Ø§Ù„ */
function renderCard(){
  // Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø·Ø¹ØŒ Ø§Ù†ØªÙ‚Ù„ Ù„ØºÙŠØ±Ù‡
  while (currentPassageIdx < selectedKeys.length &&
         currentQIdx >= indicesMap[selectedKeys[currentPassageIdx]].length) {
    currentPassageIdx++;
    currentQIdx = 0;
  }

  if (currentPassageIdx >= selectedKeys.length){
    finish();
    return;
  }

  const k = selectedKeys[currentPassageIdx];
  const title = PASSAGES[k].title;
  const words = wordsMap[k];
  const i = indicesMap[k][currentQIdx];

  const head = words.slice(i, i + prefix).join(' ');
  const tail = words.slice(i + prefix, i + prefix + suffix).join(' ');

  passageTitle.textContent = `Ø§Ù„Ù…Ù‚Ø·Ø¹: ${title}`;
  questionText.innerHTML = `<b>${head}</b> <span class="hidden-ellipses">â€¦</span>`;
  answerText.textContent = tail;
  answerArea.style.display = 'none';

  // ØªÙ‚Ø¯Ù‘Ù…: Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø£Ø³Ø¦Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø·Ø¹
  const cur = currentQIdx + 1;
  const tot = indicesMap[k].length;
  progressText.textContent = `Ø³Ø¤Ø§Ù„ ${cur} Ù…Ù† ${tot} ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø·Ø¹`;

  // Ù…Ø¤Ù‚Øª
  clearInterval(timerId);
  remaining = timerSeconds;
  updateTimer();
  timerId = setInterval(tick, 1000);
}

function tick(){
  remaining--;
  updateTimer();
  if (remaining <= 0){
    clearInterval(timerId);
    beep.play();
    nextCard(false); // Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª = Ù„Ø§ ØªÙØ¶Ø§Ù Ø¯Ø±Ø¬Ø©
  }
}
function updateTimer(){ remainingEl.textContent = remaining.toString(); }

flipBtn.onclick = ()=>{ answerArea.style.display='block'; clearInterval(timerId); };
okBtn.onclick   = ()=>{ nextCard(true); };
badBtn.onclick  = ()=>{ nextCard(false); };

function nextCard(isCorrect){
  clearInterval(timerId);
  const k = selectedKeys[currentPassageIdx];
  if (isCorrect) scores[k].correct++;
  currentQIdx++;
  renderCard();
}

/* Ø¥Ù†Ù‡Ø§Ø¡ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ÙØµÙ„Ø© */
function finish(){
  show('result');
  breakdown.innerHTML = '';
  let totalCorrect = 0, totalQs = 0;

  for (const k of selectedKeys){
    const s = scores[k];
    totalCorrect += s.correct;
    totalQs += s.total;

    const li = document.createElement('li');
    li.textContent = `${s.title}: ${s.correct} Ù…Ù† ${s.total}`;
    breakdown.appendChild(li);
  }

  finalScore.textContent = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${totalCorrect} Ù…Ù† ${totalQs}`;
}

/* Ø¥Ø¹Ø§Ø¯Ø© */
backToSelect.onclick = ()=> {
  // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±
  show('select');
};
repeatAll.onclick = ()=> {
  // Ø¥Ø¹Ø§Ø¯Ø© Ù†ÙØ³ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø¨Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
  startMultiQuiz(selectedKeys);
};

/* Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø´Ø±Ø­ */
show('intro');
</script>

</body>
</html>
